# Проверка формулы расчёта давности D: методология vs calculations.pdf

## 1. Что написано в методике (п. 6.6)

Цитаты из methodology.pdf:

1. **Калибровочная прямая:** «калибровочной прямой с **вершиной в точке G=2 при D=0**» (в момент создания участка с покрытием сумма отношений K2/K1 + Pr2/Pr1 равна ~2).

2. **Наклон:** «отношение **(G2–G1)/Δt** характеризует угол наклона прямой G(D) к оси «х»». Отрезок с концами (G1 и G2) отложен по горизонтали на интервал Δt, значит наклон прямой равен (G2−G1)/Δt.

3. **Как находят D:** «на калибровочной прямой **находят соответствующую точку G2** и определяют **ее координаты по оси «х»**, соответствующие периоду давности D».

Итого:
- Прямая в координатах (D, G) проходит через точку **(D=0, G=2)**.
- Наклон прямой: **(G2−G1)/Δt** (при Δt в месяцах).
- Уравнение прямой: **G(D) = 2 + [(G2−G1)/Δt] · D**.
- Искомую давность D находят из условия **G(D) = G2**:
  - 2 + [(G2−G1)/Δt] · D = G2  
  - [(G2−G1)/Δt] · D = G2 − 2  
  - **D = (G2 − 2) · Δt / (G2 − G1)**.

При **Δt = 1 месяц** (как в методике):

**D_методология = (G2 − 2) / (G2 − G1) = (G2 − 2) / G**,  
где **G = G2 − G1**.

---

## 2. Что используется в calculations.pdf

В parse_calculations.py верификация D выполнена так:
- `d_check = b["G1"] / g_check`, где `g_check = G2 − G1 = G`.

То есть в файле расчётов фактически используется:

**D_calculations = G1 / (G2 − G1) = G1 / G**.

Это **не** то же самое, что формула из методики.

---

## 3. Алгебраическое сравнение

| Источник        | Формула D              |
|-----------------|------------------------|
| Методология     | D = **(G2 − 2) / G**   |
| calculations.pdf| D = **G1 / G**         |

Они совпадали бы только если **G1 = G2 − 2**, т.е. G2 = G1 + 2. В общем случае это не выполняется (G1 и G2 — независимые величины из измерений), поэтому формулы **разные**.

Пример (блок 1 из calculations_verified.json):
- G1 = 6.93231, G2 = 7.05305, G = 0.12074.
- **D по методике:** (7.05305 − 2) / 0.12074 ≈ **41.9 мес.**
- **D в calculations:** 6.93231 / 0.12074 ≈ **57.4 мес.**

Один и тот же блок: по методике ~42 мес., в расчётах — ~57 мес.

---

## 4. Раздел погрешностей в методике (п. 2.4)

В тексте про погрешность написано: «Величина D является результатом отношения величин G2 и …» и «Результат величины D — отношение величин … и G2». Из-за выпавших символов в PDF однозначно восстановить формулу по этому месту нельзя, но **геометрическая схема** в п. 6.6 однозначна: прямая G(D) с вершиной в G=2 при D=0, на ней ищется точка с ординатой G2, по оси «х» считывается D. Это даёт именно **D = (G2−2)/G**, а не D = G1/G.

---

## 5. Вывод

- **В методологии** расчёт давности задаётся калибровочной прямой с **вершиной в точке G=2 при D=0** и определением D по точке с ординатой G2, что соответствует формуле **D = (G2 − 2) / (G2 − G1)** при Δt = 1 мес.
- **В calculations.pdf** для D фактически используется формула **D = G1 / (G2 − G1)**.
- Это **разные формулы**; при типичных значениях G1, G2 формула из calculations даёт **систематически бóльшую** давность (например, ~57 мес. вместо ~48 мес. в среднем по deep_analysis_report).

Итог: расхождение между методологией и файлом расчётов подтверждается — в calculations используется формула D = G1/G, тогда как из текста методики (п. 6.6) следует D = (G2−2)/G.
